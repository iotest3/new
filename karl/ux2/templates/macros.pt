<metal:macros>

  <!-- <div class="tagbox" metal:define-macro="list_tags">
    <strong class="label-tags" >Tags:</strong>
    <form id="tag-inputbox" action="javascript://return false;">
      <input name="taglist" id="tagsearch-input" value=""/>
    </form>
  </div> -->

  <section id="tags" class="tagbox contentRelated" 
    metal:define-macro="list_tags"></section>

  <div metal:define-macro="rss_icon" class="rss-icon"
       tal:condition="feed_url|None">
    <a href="${feed_url}">
        <img src="${layout.static('images/feed-icon-16x16.png')}" border="0" alt="Subscribe"
        id="RSSIcon"/>
    </a>
  </div>
 
  <span metal:define-macro="privacy_badge" class="label label-private">P</span>

  <span metal:define-macro="moderator_badge" class="label label-moderator">M</span>

  <metal:formish_js define-macro="formish_js">
    <script type="text/javascript"
        src="${layout.static('formish.js')}">//</script>
    <script type="text/javascript">
      //<![CDATA[
      $(document).ready(function() {
        formish();
      });
      //]]>
    </script>
  </metal:formish_js>

  <metal:chatter_post_display_js define-macro="chatter_post_display_js">
    <script type="text/javascript"
        src="${layout.static('ux2/js/chatter_post_display.js')}">//</script>
    <script type="text/javascript">
      //<![CDATA[
      $(document).ready(function() {
        setQuipTargets();
        setQuipActions();
      });
      //]]>
    </script>
  </metal:chatter_post_display_js>

  <script metal:define-macro="tinymce_js" type="text/javascript" 
      src="${layout.static('tinymce/tinymce-3.3.9.2.karl.js')}">//</script>

  <small metal:define-macro="byline">
    <time datetime="${byline_info.posted_date_compact}" pubdate=""
          class="globalize-full-date">${byline_info.posted_date}</time>
    by <a href="#" title="Posts by ${byline_info.author_name}" rel="author">
      ${byline_info.author_name}
    </a>.
  </small>


  <!-- Calendar macros moved over from calendar_navigation.pt -->

  <div class="cal_search_header" metal:define-macro="cal_search"
    tal:condition="python: calendar_format_class == 'karl-calendar-wide'">
    <form id="kcommunitysearch" action="${layout.community_info.url}calendar_searchresults.html">
      <fieldset>
        <input type="text" class="inp search-community-input" name="body"/>
        <button type="submit" class="search-community-button">Search</button>
      </fieldset>
    </form>
    <h1>${calendar_object.title}</h1>
  </div>

  <div class="cal_header" metal:define-macro="cal_header">
    <div class="cal_calendars" >
      <div class="cal_choose">
        <label for="">
          Layer:
        </label>
        <select id="cal_picker">
          <option
                  tal:attributes="value layout.request.path_url + '?filter=';
                                  class 'group'"
                  >All layers</option>
          <option
                  tal:repeat="layer layers"
                  tal:attributes="value layout.request.path_url + '?filter=' + layer.__name__;
                                  class 'color cal_' + layer.color.strip();
                                  selected layer.__name__ == selected_layer"
                  >${layer.title}</option>
        </select>

        <tal:block condition="setup_url">
          (<a href="${setup_url}">Setup</a>)
        </tal:block>
      </div>

      <!-- new event -->
      <div class="cal_new_event" tal:condition="may_create">
        <a class="primary_button" href="${calendar.add_event_url}"><span>Add Event</span></a>
      </div>
      <div class="cal_new_event" tal:condition="not may_create and mailto_create_event_href">
        <a class="primary_button" href="${mailto_create_event_href}"><span>Need to Add an Event?</span></a>
      </div>
    </div>

    <!-- buttons -->
    <div class="cal_buttons cal-toolbar"></div>
    <script type="text/javascript">
      $(function () {
          $('.cal-toolbar').karlcalendarbuttons($.extend({}, {
              //selection: ${widgets['calendar']['selection']},
              change: function(evt, selection) {
                  // For now, we submit to the correct url.
                  // In the future, we will want to do ajax here. 
                  var view_name;
                  var more = '';
                  if (selection.viewtype == 'list') {
                      view_name = 'list.html';
                      more = '&term=' + selection.term;
                  } else {
                      view_name = {
                          month: 'month.html',
                          week: 'week.html',
                          day: 'day.html'
                      }[selection.term];
                  }
                  var url = head_data.context_url + view_name + 
                      '?year=' + selection.year +
                      '&month=' + selection.month +
                      '&day=' + selection.day +
                      more;
                  // user cannot click now, cue this
                  $(this).karlcalendarbuttons('disable');

                  document.location.href = url;
              }
          }, ${widgets['calendar']}));
      });
    </script>
  </div>

  <div class="cal_footer clearafter" metal:define-macro="cal_footer">
    <!-- actions -->
    <div class="cal_actions">
       <!-- <a class="cal_download" href="#">Download</a> -->
       <span><a class="cal_subscribe" href="${calendar.feed_url}">Subscribe</a></span>
       <span><a class="cal_print" href="#">Print</a></span>
    </div>
  </div>


</metal:macros>
