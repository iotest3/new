<div id='${html_id}' class='${html_class}'>

  <div class="cal_calendars" >
    <div class="cal_choose">
      <label for="">
        Layer:
      </label>
      <select id="cal_picker">
        <option
                tal:attributes="value layout.request.path_url + '?filter=';
                                class 'group'"
                >All layers</option>
        <option
                tal:repeat="layer layers"
                tal:attributes="value layout.request.path_url + '?filter=' + layer.__name__;
                                class 'color cal_' + layer.color.strip();
                                selected layer.__name__ == selected_layer"
                >${layer.title}</option>
      </select>

      <tal:block condition="setup_url">
        (<a href="${setup_url}">Setup</a>)
      </tal:block>
    </div>

    <!-- new event -->
    <div class="cal_new_event" tal:condition="may_create">
      <a class="primary_button" href="${calendar.add_event_url}"><span>Add Event</span></a>
    </div>
    <div class="cal_new_event" tal:condition="not may_create and mailto_create_event_href">
      <a class="primary_button" href="${mailto_create_event_href}"><span>Need to Add an Event?</span></a>
    </div>
  </div>

  <!-- buttons -->
  <div class="cal_buttons cal-toolbar">
    <span class="karl-calendar-buttonset-term">
        <input type="radio" name="karl-calendar-buttonset-term" 
          id="karl-calendar-button-day" class="karl-calendar-button-day">
        </input><label for="karl-calendar-button-day">Day</label>
        <input type="radio" name="karl-calendar-buttonset-term" 
          id="karl-calendar-button-week" class="karl-calendar-button-week">
        </input><label for="karl-calendar-button-week">Week</label>
        <input type="radio" name="karl-calendar-buttonset-term" 
          id="karl-calendar-button-month" class="karl-calendar-button-month">
        </input><label for="karl-calendar-button-month">Month</label>
    </span>
    <span class="karl-calendar-buttonset-viewtype">
        <input type="radio" name="karl-calendar-buttonset-viewtype" 
          id="karl-calendar-button-calendar" class="karl-calendar-button-calendar">
        </input><label for="karl-calendar-button-calendar">Calendar</label>
        <input type="radio" name="karl-calendar-buttonset-viewtype" 
          id="karl-calendar-button-list" class="karl-calendar-button-list">
        </input><label for="karl-calendar-button-list">List</label>
    </span>
    <button class="karl-calendar-button-today">Today</button>
    <span class="karl-calendar-buttonset-navigate">
        <input type="radio" name="karl-calendar-buttonset-navigate" 
          id="karl-calendar-button-prev" class="karl-calendar-button-prev">
        </input>
        <label for="karl-calendar-button-prev" class="karl-calendar-label-prev">&nbsp;</label>
        <input type="radio" name="karl-calendar-buttonset-navigate" 
          id="karl-calendar-button-next" class="karl-calendar-button-next">
        </input>
        <label for="karl-calendar-button-next" class="karl-calendar-label-next">&nbsp;</label>
    </span>
    <select class="karl-calendar-dropdown-year">
    </select>
    <select class="karl-calendar-dropdown-month">
        <option value="1">Jan</option>
        <option value="2">Feb</option>
        <option value="3">Mar</option>
        <option value="4">Apr</option>
        <option value="5">May</option>
        <option value="6">Jun</option>
        <option value="7">Jul</option>
        <option value="8">Aug</option>
        <option value="9">Sep</option>
        <option value="10">Oct</option>
        <option value="11">Nov</option>
        <option value="12">Dec</option>
    </select>
    <select class="karl-calendar-dropdown-day">
    </select>
  </div>
  <script language="javascript" type="text/javascript">
    $(function () {
        $('#${html_id} .cal-toolbar').karlcalendarbuttons($.extend({}, {
            //selection: ...
            change: function(evt, selection) {
                // Selection changed? Resubmit the page to the correct url.
                // Calculate which url this shall be... 
                var view_name;
                var more = '';
                if (selection.viewtype == 'list') {
                    view_name = 'list.html';
                    more = '&term=' + selection.term;
                } else {
                    view_name = {
                        month: 'month.html',
                        week: 'week.html',
                        day: 'day.html'
                    }[selection.term];
                }
                var url = head_data.context_url + view_name + 
                    '?year=' + selection.year +
                    '&month=' + selection.month +
                    '&day=' + selection.day +
                    more;
                // user cannot click now, cue this visually
                $(this).karlcalendarbuttons('disable');
                // ... finally, resubmit the page.
                document.location.href = url;
            }
        }, ${toolbar_options}));
    });
  </script>
</div>
