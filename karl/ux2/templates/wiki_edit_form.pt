<metal:page use-macro="main_template">

  <!-- TEMPORARY -->
  <metal:tail fill-slot="head_slot">
    <metal:formish use-macro="layout.macros['formish_js']"/>
  </metal:tail>
  <!-- TEMPORARY -->


  <div metal:fill-slot="content">
    
    <header tal:define="actions actions_menu|actions|None">
      ${panel('status_message')}
      ${panel('error_message')}
      ${panel('actions_menu', actions=actions)}
      <h1>${layout.page_title}</h1>
    </header>

    <p tal:content="page_description|''"/>
    <div tal:condition="blurb|False" tal:replace="blurb"/>
    <span tal:replace="structure request.form()" />

    <script type="text/javascript">
        jQuery(function ($) {
            var here_url = $("#karl-here-url").eq(0).attr('content');
            var here_url = head_data.context_url;
            var maybeSlash = here_url.match(/\/$/) ? '' : '/';
            var unlock_url = here_url + maybeSlash + 'unlock.html';
            $(window).bind('beforeunload', function() {
                $.ajax({type: 'POST',
                        url: unlock_url,
                        data: {},
                        async: false
                       });
            });
        });
    </script>


  </div>
 
</metal:page>
